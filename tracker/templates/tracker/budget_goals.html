{% extends 'base.html' %}

{% block title %}Budget Goals{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1 class="page-title">Budget Goals</h1>
            <p class="page-subtitle">Set spending limits for each category</p>
        </div>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
    </div>
</div>

<!-- Add New Goal -->
<div class="card" style="margin-bottom: 2rem;">
    <div class="card-header">
        <h2 class="card-title">Set New Budget Goal</h2>
    </div>
    <form method="post" action="{% url 'add_budget_goal' %}" style="padding: 1.5rem;">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: end;">
            <div>
                <label class="form-label">Category</label>
                <select name="category" class="form-control" required>
                    <option value="">Select category</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="form-label">Monthly Limit (‚Çπ)</label>
                <input type="number" name="monthly_limit" class="form-control" step="0.01" placeholder="5000" required>
            </div>
            <button type="submit" class="btn btn-primary" style="height: 42px;">Add Goal</button>
        </div>
    </form>
</div>

<!-- Existing Goals -->
<div style="display: grid; gap: 1.5rem;">
    {% for item in goals_with_spending %}
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
                <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">
                    {{ item.goal.category.name }}
                </h3>
                <p style="color: var(--text-secondary); font-size: 0.875rem;">
                    Budget: ‚Çπ{{ item.goal.monthly_limit|floatformat:0 }}
                </p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.5rem; font-weight: 700; {% if item.percentage > 90 %}color: var(--danger);{% elif item.percentage > 70 %}color: var(--warning);{% else %}color: var(--success);{% endif %}">
                    {{ item.percentage|floatformat:0 }}%
                </div>
                <div style="font-size: 0.8125rem; color: var(--text-tertiary);">used</div>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div style="background: var(--bg-secondary); height: 12px; border-radius: 6px; overflow: hidden; margin-bottom: 1rem;">
            <div style="height: 100%; background: {% if item.percentage > 90 %}var(--danger){% elif item.percentage > 70 %}var(--warning){% else %}var(--success){% endif %}; width: {{ item.percentage }}%; transition: width 0.3s ease;"></div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
            <div>
                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Spent</div>
                <div style="font-weight: 700; color: var(--danger);">‚Çπ{{ item.spent|floatformat:0 }}</div>
            </div>
            <div>
                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Remaining</div>
                <div style="font-weight: 700; color: {% if item.remaining >= 0 %}var(--success){% else %}var(--danger){% endif %};">
                    ‚Çπ{{ item.remaining|floatformat:0 }}
                </div>
            </div>
            <div>
                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 0.25rem;">Status</div>
                <div style="font-weight: 600;">
                    {% if item.percentage > 100 %}
                    <span style="color: var(--danger);">‚ö†Ô∏è Over Budget</span>
                    {% elif item.percentage > 90 %}
                    <span style="color: var(--warning);">‚ö†Ô∏è Almost There</span>
                    {% else %}
                    <span style="color: var(--success);">‚úì On Track</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state">
        <div class="empty-icon">üéØ</div>
        <h3 class="empty-title">No budget goals yet</h3>
        <p class="empty-text">Set spending limits to track your budget better</p>
    </div>
    {% endfor %}
</div>
{% endblock %}
